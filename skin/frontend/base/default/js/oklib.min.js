var oklibpresenter=function(){var a,b;return{instantiate:function(){"undefined"===typeof a&&(a=new window.oklib.OKLIB);"undefined"===typeof b&&(b=new window.oklib.OKLIB)},showExisting:function(c){"cash"===c?a.show():"open"===c&&b.show()},showNew:function(c,d){var e={color:"dark",culture:d.culture,initiation:d.initiation};"cash"===c?(e.loaded=a.start,a.init("t",d.guid,e,d.environment)):"open"===c&&(e.loaded=b.start,b.init("a",d.guid,e,d.environment))},isInitialized:function(c){if("cash"===
c)return a.isInitialized();if("open"===c)return b.isInitialized()},reset:function(c){"cash"===c?(a.isInitialized()&&a.hide(),a=new window.oklib.OKLIB):"open"===c&&(b.isInitialized()&&b.hide(),b=new window.oklib.OKLIB)}}}();function showMessage(a,b){var c=window.jQuery(".col-main"),d='<li class="'+b+'-msg"><ul><li>'+a+"</li></ul></li>",e=window.jQuery("ul.messages");null!=e&&e.length||(e=window.jQuery('<ul class="messages"></ul>').prependTo(c));e.append(window.jQuery(d))}
function getOkStoreUrl(a){return"undefined"!==window.okStoreInfo.store_url?okStoreInfo.store_url+a:"/".path}var loadingOkRequest=!1;
$(document).on("click","#ok-checkout-button",function(a){oklibpresenter.instantiate();a.preventDefault();if(!loadingOkRequest)if(oklibpresenter.isInitialized("cash"))oklibpresenter.showExisting("cash");else{var b=window.jQuery("#ok-checkout-button");b.addClass("ok-button-progress");loadingOkRequest=!0;window.jQuery.ajax({showLoader:!0,url:getOkStoreUrl("oklib/cash/init"),data:"",type:"GET",dataType:"json"}).done(function(a){loadingOkRequest=!1;b.removeClass("ok-button-progress");a.error?showMessage(a.error,
"error"):oklibpresenter.showNew("cash",a)}).error(function(a,d){loadingOkRequest=!1;b.removeClass("ok-button-progress");showMessage("Your transaction amount exceeds the maximum that is supported by OK.","error")})}});var lastSelectedOptions=null;
$(document).on("click","#ok-buynow-button",function(a){oklibpresenter.instantiate();if(loadingOkRequest)a.preventDefault();else{var b=$("product_addtocart_form").serialize();null!=lastSelectedOptions&&lastSelectedOptions!==b&&oklibpresenter.reset("cash");lastSelectedOptions=b;if(oklibpresenter.isInitialized("cash"))oklibpresenter.showExisting(type),a.preventDefault();else if((new VarienForm("product_addtocart_form",!0)).validator.validate()){a.preventDefault();var c=window.jQuery("#ok-buynow-button");
c.addClass("ok-button-progress");loadingOkRequest=!0;window.jQuery.ajax({showLoader:!0,url:getOkStoreUrl("oklib/cash/buynow"),data:lastSelectedOptions,type:"GET",dataType:"json"}).done(function(a){loadingOkRequest=!1;c.removeClass("ok-button-progress");a.error?showMessage(a.error,"error"):oklibpresenter.showNew("cash",a)}).error(function(a,b){loadingOkRequest=!1;c.removeClass("ok-button-progress");showMessage("An unknown error occurred.","error")})}}});
$(document).on("click","#ok-open-button",function(){oklibpresenter.instantiate();if(!loadingOkRequest)if(oklibpresenter.isInitialized("open"))oklibpresenter.showExisting("open");else{var a=window.jQuery("#ok-open-button");a.addClass("ok-button-progress");loadingOkRequest=!0;window.jQuery.ajax({showLoader:!0,url:getOkStoreUrl("oklib/open/init"),data:"",type:"GET",dataType:"json"}).done(function(b){loadingOkRequest=!1;a.removeClass("ok-button-progress");b.error?showMessage(b.error,"error"):oklibpresenter.showNew("open",
b)}).error(function(b,c){loadingOkRequest=!1;a.removeClass("ok-button-progress");showMessage("An unknown error occurred.","error")})}});