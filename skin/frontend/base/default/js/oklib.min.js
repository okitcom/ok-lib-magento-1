var oklibpresenter={showExisting:function(e){return window.okLibType===e&&(window.oklib.show(),!0)},showNew:function(e,o){const r=window.okLibType;void 0!==r&&null!=r&&window.oklib.remove(),window.okLibType=e,window.oklib.init(function(e){switch(e){case"open":return"a";case"cash":return"t"}return null}(e),o.guid,{color:"dark",culture:o.culture,loaded:oklib.start,initiation:o.initiation},o.environment)},remove:function(){void 0!==window.okLibType&&window.oklib.remove(),window.okLibType=null}};function showMessage(e,o){var r=window.jQuery(".col-main"),n='<li class="'+o+'-msg"><ul><li>'+e+"</li></ul></li>",t=window.jQuery("ul.messages");null!=t&&t.length||(t=window.jQuery('<ul class="messages"></ul>').prependTo(r)),t.append(window.jQuery(n))}function getOkStoreUrl(e){return"undefined"!==window.okStoreInfo.store_url?okStoreInfo.store_url+e:"/".path}var loadingOkRequest=!1;$(document).on("click","#ok-checkout-button",function(e){if(e.preventDefault(),loadingOkRequest)return;if(!oklibpresenter.showExisting("cash")){var o=window.jQuery("#ok-checkout-button");o.addClass("ok-button-progress"),loadingOkRequest=!0,window.jQuery.ajax({showLoader:!0,url:getOkStoreUrl("oklib/cash/init"),data:"",type:"GET",dataType:"json"}).done(function(e){loadingOkRequest=!1,o.removeClass("ok-button-progress"),e.error?showMessage(e.error,"error"):oklibpresenter.showNew("cash",e)}).error(function(e,r){loadingOkRequest=!1,o.removeClass("ok-button-progress"),showMessage("Your transaction amount exceeds the maximum that is supported by OK.","error")})}});var lastSelectedOptions=null;$(document).on("click","#ok-buynow-button",function(e){if(loadingOkRequest)return void e.preventDefault();var o=!1,r=$("product_addtocart_form").serialize();if(null!=lastSelectedOptions&&lastSelectedOptions!==r&&(o=!0),lastSelectedOptions=r,o||!oklibpresenter.showExisting("cash")){if(!new VarienForm("product_addtocart_form",!0).validator.validate())return;e.preventDefault();var n=window.jQuery("#ok-buynow-button");n.addClass("ok-button-progress"),loadingOkRequest=!0,window.jQuery.ajax({showLoader:!0,url:getOkStoreUrl("oklib/cash/buynow"),data:lastSelectedOptions,type:"GET",dataType:"json"}).done(function(e){loadingOkRequest=!1,n.removeClass("ok-button-progress"),e.error?showMessage(e.error,"error"):oklibpresenter.showNew("cash",e)}).error(function(e,o){loadingOkRequest=!1,n.removeClass("ok-button-progress"),showMessage("An unknown error occurred.","error")})}else e.preventDefault()}),$(document).on("click","#ok-open-button",function(){if(loadingOkRequest)return;if(!oklibpresenter.showExisting("open")){var e=window.jQuery("#ok-open-button");e.addClass("ok-button-progress"),loadingOkRequest=!0,window.jQuery.ajax({showLoader:!0,url:getOkStoreUrl("oklib/open/init"),data:"",type:"GET",dataType:"json"}).done(function(o){loadingOkRequest=!1,e.removeClass("ok-button-progress"),o.error?showMessage(o.error,"error"):oklibpresenter.showNew("open",o)}).error(function(o,r){loadingOkRequest=!1,e.removeClass("ok-button-progress"),showMessage("An unknown error occurred.","error")})}});